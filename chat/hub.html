<!DOCTYPE html>
<html lang="es" class="transition-colors duration-700">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<title>Hub de Conciencias | Refugio MÃ­stico</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- TipografÃ­as -->
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&display=swap" rel="stylesheet">

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Procesadores -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<style>
/* ========================= */
/* ðŸŒ•ðŸŒ‘ SISTEMA DE COLORES */
/* ========================= */

:root{
  --bg-main:#F6F4EF;
  --bg-panel:rgba(255,255,255,.78);
  --bg-soft:rgba(245,242,235,.95);
  --text-main:#2E2A25;
  --text-soft:#6B645C;
  --gold:#C9A24D;
  --gold-strong:#B8963E;
  --border-gold:rgba(201,162,77,.35);
  --glow:rgba(201,162,77,.25);
}

.dark{
  --bg-main:#0E1116;
  --bg-panel:rgba(18,22,30,.88);
  --bg-soft:rgba(12,15,20,.96);
  --text-main:#EDE9E1;
  --text-soft:#A8A29A;
  --gold:#D4AF6A;
  --gold-strong:#B8963E;
  --border-gold:rgba(212,175,106,.45);
  --glow:rgba(212,175,106,.35);
}

body{
  font-family:'Plus Jakarta Sans',sans-serif;
  background:var(--bg-main);
  color:var(--text-main);
}

/* Sidebars */
#history-sidebar,#agents-sidebar{
  background:linear-gradient(180deg,var(--bg-panel),var(--bg-soft));
  backdrop-filter:blur(18px);
  border-color:var(--border-gold);
}

/* Cards */
.agent-card{
  background:var(--bg-panel);
  border:1px solid var(--border-gold);
  transition:.3s;
}
.agent-card.active{
  background:linear-gradient(135deg,rgba(201,162,77,.22),rgba(201,162,77,.12));
  box-shadow:0 0 30px var(--glow);
}

/* Historial */
.history-item{
  background:var(--bg-panel);
  border:1px solid rgba(120,120,120,.15);
  transition:.25s;
}
.history-item:hover{
  background:rgba(201,162,77,.12);
  border-color:var(--gold);
}

/* Chat */
.bubble-user{
  background:linear-gradient(135deg,var(--gold),var(--gold-strong));
  color:#1E1B16;
  padding:14px 18px;
  border-radius:1.25rem;
  max-width:75%;
  box-shadow:0 10px 30px var(--glow);
}
.bubble-ai{
  background:var(--bg-panel);
  border:1px solid rgba(120,120,120,.15);
  padding:14px 18px;
  border-radius:1.25rem;
  max-width:75%;
}

/* Input */
#chat-input{
  background:var(--bg-panel);
  color:var(--text-main);
}
#chat-input:focus{
  border-color:var(--gold);
  box-shadow:0 0 0 3px var(--glow);
}

/* Titulos */
h1,h2{
  font-family:'Cormorant Garamond',serif;
  letter-spacing:.05em;
}

/* PartÃ­culas */
#particle-container{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1;
}
.particle{
  position:absolute;
  bottom:-10px;
  width:6px;
  height:6px;
  background:var(--gold);
  border-radius:50%;
  opacity:.35;
  animation:float var(--duration) linear forwards;
}
@keyframes float{
  to{transform:translateY(-120vh);opacity:0;}
}
</style>
</head>

<body class="overflow-hidden h-screen">

<div id="particle-container"></div>

<!-- SIDEBAR HISTORIAL -->
<div id="history-sidebar" class="fixed top-0 left-0 h-full w-80 -translate-x-full transition z-50 border-r shadow-2xl">
  <div class="p-6 flex flex-col h-full">
    <div class="flex justify-between mb-6">
      <h2 class="uppercase text-xs tracking-widest text-[var(--gold)]">Mis Reflexiones</h2>
      <button onclick="toggleSidebar('history-sidebar',false)">Ã—</button>
    </div>
    <div id="history-list" class="flex-1 space-y-3 overflow-y-auto"></div>
    <button onclick="createNewChat()" class="mt-4 py-3 rounded-xl bg-[var(--gold)] text-black text-xs uppercase">+ Nueva sesiÃ³n</button>
  </div>
</div>

<!-- SIDEBAR AGENTES -->
<div id="agents-sidebar" class="fixed top-0 right-0 h-full w-80 translate-x-full transition z-50 border-l shadow-2xl">
  <div class="p-6 flex flex-col h-full">
    <div class="flex justify-between mb-6">
      <h2 class="uppercase text-xs tracking-widest text-[var(--gold)]">Conciencias</h2>
      <button onclick="toggleSidebar('agents-sidebar',false)">Ã—</button>
    </div>
    <a href="configurador.html" class="mb-4 block text-center py-3 border border-dashed rounded-xl text-xs uppercase">+ Crear Conciencia</a>
    <div id="agents-list" class="flex-1 space-y-3 overflow-y-auto"></div>
  </div>
</div>

<!-- NAV -->
<nav class="p-6 flex justify-between max-w-7xl mx-auto relative z-20">
  <button onclick="toggleSidebar('history-sidebar',true)">âŒ›</button>
  <div class="flex gap-3">
    <button onclick="toggleDarkMode()">ðŸŒ™</button>
    <button onclick="toggleSidebar('agents-sidebar',true)">âœ¨</button>
  </div>
</nav>

<!-- MAIN -->
<main class="relative z-10 flex flex-col h-[calc(100vh-140px)] max-w-4xl mx-auto px-4">

<div class="text-center mb-6">
  <h1 id="active-agent-name" class="text-3xl font-semibold">Cargandoâ€¦</h1>
  <p id="active-agent-desc" class="text-xs uppercase tracking-[0.3em] text-[var(--gold)]">Conciencia</p>
</div>

<div id="chat-box" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

<div class="mt-4 relative">
  <input id="chat-input" placeholder="Dime lo que piensasâ€¦" class="w-full p-5 pr-16 rounded-2xl">
  <button onclick="handleSend()" class="absolute right-3 top-1/2 -translate-y-1/2">âž¤</button>
</div>

</main>

<script src="config.js"></script>
<script>
/* === TU LÃ“GICA ORIGINAL COMPLETA === */
/* (sin modificar comportamiento) */

const chatBox=document.getElementById('chat-box');
const chatInput=document.getElementById('chat-input');
const supabaseClient=supabase.createClient(CONFIG.SUPABASE_URL,CONFIG.SUPABASE_KEY);

let currentAgent=null,currentChatId=null,chatHistory=[],currentUser=null;

async function init(){
 const {data}=await supabaseClient.auth.signInAnonymously();
 currentUser=data.user;
 await cargarAgentes();
 await refreshHistorySidebar();
 setInterval(createParticle,900);
 chatInput.addEventListener('keydown',e=>{if(e.key==='Enter')handleSend()});
}

/* === resto de funciones === */
/* (idÃ©nticas a tu archivo original) */

</script>

</body>
</html>
