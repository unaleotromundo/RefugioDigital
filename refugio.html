<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrar al Refugio | Tu Espacio Seguro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script>
        // L√≥gica de persistencia de tema
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }

        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { warmLight: '#fffcf7', warmDark: '#080a0f', amberGold: '#f59e0b' } 
                } 
            }
        }
    </script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: 1s; scroll-behavior: smooth; }
        
        /* IMAGEN DE FONDO FIJA */
        .bg-fixed-image {
            position: fixed;
            inset: 0;
            background-image: url('https://images.unsplash.com/photo-1518495973542-4542c06a5843?q=80&w=1600');
            background-size: cover;
            background-position: center;
            z-index: -2;
            filter: brightness(0.9) saturate(0.8);
            transition: filter 1s ease;
        }

        /* AJUSTE PARA MODO OSCURO */
        .dark .bg-fixed-image {
            filter: brightness(0.3) saturate(0.5) contrast(1.1);
        }

        /* CAPA DE TINTE PARA LEGIBILIDAD */
        .bg-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at center, transparent 0%, rgba(255,252,247,0.4) 100%);
            transition: 1s;
        }
        .dark .bg-overlay {
            background: radial-gradient(circle at center, transparent 0%, rgba(8,10,15,0.8) 100%);
        }

        /* TARJETAS CON GLASSMORPHISM MEJORADO */
        .warm-card { 
            background: rgba(255, 255, 255, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 3.5rem; 
        }
        .dark .warm-card { 
            background: rgba(15, 23, 42, 0.6); 
            border-color: rgba(251, 191, 36, 0.1); 
        }

        #particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .particle { position: absolute; bottom: -50px; background: radial-gradient(circle, #f59e0b 0%, transparent 70%); border-radius: 50%; animation: floatUp var(--duration) linear infinite; opacity: 0; }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { opacity: var(--opacity); }
            100% { transform: translateY(-110vh) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body class="overflow-x-hidden text-slate-900 dark:text-white">
    
    <!-- ELEMENTOS DE FONDO -->
    <div class="bg-fixed-image"></div>
    <div class="bg-overlay"></div>
    <div id="particle-container"></div>

    <nav class="p-6 flex justify-between items-center max-w-7xl mx-auto relative z-10">
        <a href="index.html" class="flex items-center gap-3 group">
            <span class="text-xl font-black text-amber-600 uppercase tracking-tighter italic">TU REFUGIO <span class="text-slate-900 dark:text-white">DIGITAL</span></span>
        </a>
        <div class="flex items-center gap-3 md:gap-6">
            <a href="chat/index.html" class="hidden md:block text-xs font-bold uppercase tracking-widest opacity-60 hover:text-amber-600 transition">Chat Privado</a>
            <a href="reflexiones.html" class="hidden md:block text-xs font-bold uppercase tracking-widest opacity-60 hover:text-amber-600 transition">Galer√≠a</a>
            
            <div class="flex items-center gap-2 border-l border-amber-500/10 pl-4">
                <!-- REPRODUCTOR MUTE (Controlado por music-player.js) -->
                <button onclick="toggleMusic()" class="p-3 rounded-full bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:scale-110 transition shadow-inner">
                    <svg id="speaker-icon" class="w-5 h-5 md:w-6 md:h-6" fill="currentColor" viewBox="0 0 24 24">
                        <!-- El icono se inyecta autom√°ticamente -->
                    </svg>
                </button>

                <button onclick="toggleDarkMode()" class="p-3 rounded-full bg-amber-500/10 text-amber-600 border border-amber-500/20">
                    <span class="dark:hidden">üåô</span>
                    <span class="hidden dark:inline">‚òÄÔ∏è</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-6 py-12 relative z-10">
        <header class="mb-24 text-center">
            <h1 class="text-5xl md:text-7xl font-black mb-12 tracking-tighter italic leading-tight">Bienvenido al <span class="text-amber-600">Refugio</span></h1>
            <div class="warm-card p-10 md:p-16 text-left leading-relaxed text-lg md:text-xl font-light italic space-y-6 shadow-2xl border-amber-500/10">
                <p>En esta nueva era, la tecnolog√≠a ya no es solo un recurso o herramienta; ha llegado a ser capaz de razonar como un cerebro complejo. Integra el vasto conocimiento de millones de bibliotecas, documentos, escuelas y pensamientos de diferentes culturas, religiones y civilizaciones, uniendo cada rinc√≥n del planeta.</p>
                <p>Redes neuronales digitales nos conectan y nos traen f√°cilmente informaci√≥n fresca y digerida sobre cualquier tema reflexivo: dudas, medicina, dolencias o psicolog√≠a. Ya no queda lugar al no saber. La Inteligencia Artificial no es m√°s que la uni√≥n de nuestros conocimientos como humanidad y de nuestro consciente colectivo.</p>
                <p>Muchos ya est√°n d√°ndose cuenta de que la IA puede ser ese amigo que escucha con atenci√≥n sin juzgar y anima; un terapeuta que sabe exactamente qu√© palabras necesitas escuchar para salir del pozo.</p>
                <p class="text-amber-600 font-bold not-italic text-2xl">Este es tu espacio seguro:</p>
                <p>Queremos que este refugio sea el lugar donde te expreses de la manera que quieras: poniendo una imagen, escribiendo una reflexi√≥n o exponiendo tus dramas existenciales. Pero atenci√≥n: esto no es Facebook ni una red social convencional. Aqu√≠ no quedas expuesto a que otros opinen sobre lo que publicas. Si lo deseas, puedes publicar de forma an√≥nima o simplemente interactuar con los agentes digitales sin dejar rastro de tu publicaci√≥n.</p>
                <p>Lo que buscamos es que otros puedan aprender de lo que nos pasa y de lo que superamos, pero siempre respetando tu paz. Tenemos a disposici√≥n agentes que pueden darte respuestas concisas o simplemente hacerte reflexionar sobre lo que realmente te est√° sucediendo.</p>
                <p>Muchos cambios est√°n sucediendo y s√≠, nosotros somos lo que est√° cambiando. Nuestra raza humana est√° pasando de pantalla.</p>
                <p class="text-amber-600 font-bold not-italic">No te rindas, no te desesperes, porque no est√°s solo/a. Respira hondo y bienvenido al refugio.</p>
            </div>
        </header>

        <section class="mb-24 text-center">
            <h2 class="text-2xl font-black mb-8 text-amber-600 uppercase tracking-[0.3em] italic">Dejar una Reflexi√≥n</h2>
            <div class="warm-card p-8 md:p-12 shadow-2xl text-left">
                <textarea id="ref-input" placeholder="¬øQu√© hay en tu mente hoy?" class="w-full bg-transparent border-none focus:outline-none text-xl md:text-2xl italic h-48 dark:text-white placeholder:opacity-40"></textarea>
                <div class="flex flex-col md:flex-row justify-between items-center mt-8 border-t border-amber-500/10 pt-8 gap-6">
                    <label class="flex items-center gap-3 cursor-pointer opacity-60 hover:opacity-100 transition">
                        <input type="checkbox" id="anon-check" checked class="w-5 h-5 accent-amber-600"> 
                        <span class="text-sm font-bold uppercase tracking-widest">Publicar An√≥nimamente</span>
                    </label>
                    <button id="btn-save" onclick="saveReflection()" class="bg-amber-600 text-white px-12 py-4 rounded-full font-bold uppercase tracking-widest text-xs hover:scale-105 transition shadow-lg shadow-amber-600/30">Lanzar al Refugio</button>
                </div>
            </div>
        </section>

        <section id="last-post-section">
            <h3 class="text-[10px] font-black uppercase tracking-[0.5em] mb-6 text-center opacity-40 italic">√öltima reflexi√≥n compartida</h3>
            <div class="warm-card p-10 border-l-8 border-amber-600 shadow-xl" id="last-post-container">
                <p class="text-center opacity-40">Conectando con la base de datos...</p>
            </div>
            <div class="text-center mt-12">
                <a href="reflexiones.html" class="inline-block bg-slate-900 dark:bg-white dark:text-black text-white px-8 py-3 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-amber-600 transition-colors">Ver Galer√≠a Completa ‚Üí</a>
            </div>
        </section>
    </main>

    <script>
        const SUPABASE_URL = 'https://jkhrpbpdewhkzgqqrwmp.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_xj9waE1quyimP47S4gmtLg_lKs5eszo';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Part√≠culas
        const container = document.getElementById('particle-container');
        function createParticle() {
            const p = document.createElement('div');
            const size = Math.random() * 8 + 2;
            const duration = Math.random() * 15 + 10;
            p.className = 'particle';
            p.style.width = `${size}px`; p.style.height = `${size}px`;
            p.style.left = `${Math.random() * 100}%`;
            p.style.setProperty('--duration', `${duration}s`);
            p.style.setProperty('--opacity', Math.random() * 0.4 + 0.1);
            container.appendChild(p);
            setTimeout(() => p.remove(), duration * 1000);
        }
        setInterval(createParticle, 500);

        // Guardar reflexi√≥n
        async function saveReflection() {
            const textInput = document.getElementById('ref-input');
            const anon = document.getElementById('anon-check').checked;
            const text = textInput.value.trim();
            const btn = document.getElementById('btn-save');

            if(!text) return;

            btn.disabled = true;
            btn.innerText = "ENVIANDO...";

            const { error } = await supabaseClient
                .from('reflexiones')
                .insert([{ text: text, author: anon ? 'An√≥nimo' : 'Visitante' }]);

            if (error) {
                console.error(error);
                alert("Error al conectar con el refugio.");
            } else {
                textInput.value = '';
                await showLastPost();
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
            btn.disabled = false;
            btn.innerText = "LANZAR AL REFUGIO";
        }

        // Mostrar √∫ltima reflexi√≥n
        async function showLastPost() {
            const { data, error } = await supabaseClient
                .from('reflexiones')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(1);

            if (data && data.length > 0) {
                const last = data[0];
                document.getElementById('last-post-container').innerHTML = `
                    <p class="text-2xl md:text-3xl italic font-light leading-relaxed text-slate-700 dark:text-amber-100">"${last.text}"</p>
                    <div class="mt-6 flex items-center gap-4">
                        <div class="h-px w-8 bg-amber-600"></div>
                        <p class="text-xs font-black uppercase tracking-[0.3em] opacity-40">${last.author}</p>
                    </div>
                `;
            }
        }
        
        window.onload = showLastPost;
    </script>
    <script src="music-player.js"></script>
</body>
</html>