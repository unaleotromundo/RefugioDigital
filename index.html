<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    
    <!-- SEO B√ÅSICO -->
    <title>Tu Refugio Digital | Faro de Significado y Prop√≥sito</title>
    <meta name="description" content="En un mundo a veces ca√≥tico, es f√°cil perderse. Aqu√≠ encontrar√°s un faro que te guiar√° en tu b√∫squeda de significado y prop√≥sito. Compartamos nuestras experiencias y aprendamos unos de otros.">
    <link rel="icon" type="image/png" href="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png">

    <!-- PWA MANIFEST -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA: Theme color -->
    <meta name="theme-color" content="#f59e0b">
    <meta name="theme-color" content="#080a0f" media="(prefers-color-scheme: dark)">
    
    <!-- PWA: Para m√≥viles -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Refugio Digital">
    <link rel="apple-touch-icon" href="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png">
    
    <!-- PWA: Para Windows -->
    <meta name="msapplication-TileImage" content="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png">
    <meta name="msapplication-TileColor" content="#f59e0b">

    <!-- SEO PARA COMPARTIR -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://refugiodigital.vercel.app">
    <meta property="og:title" content="Tu Refugio Digital | Faro de Significado y Prop√≥sito">
    <meta property="og:description" content="En un mundo a veces ca√≥tico, es f√°cil perderse. Aqu√≠ encontrar√°s un faro que te guiar√° en tu b√∫squeda de significado y prop√≥sito. Compartamos nuestras experiencias y aprendamos unos de otros.">
    <meta property="og:image" content="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png">
    
    <!-- SCRIPTS Y ESTILOS -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { warmLight: '#fffcf7', warmDark: '#080a0f', amberGold: '#f59e0b' } 
                } 
            }
        }
    </script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; scroll-behavior: smooth; overflow-x: hidden; }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(245, 158, 11, 0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 2rem 1.5rem;
            transition: transform 0.3s ease;
        }
        .dark .sidebar {
            background: rgba(8, 10, 15, 0.95);
            border-right-color: rgba(245, 158, 11, 0.05);
        }
        
        .sidebar-logo {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(245, 158, 11, 0.1);
        }
        
        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .sidebar-link {
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .sidebar-link:hover {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            transform: translateX(5px);
        }
        
        .sidebar-link.active {
            background: #f59e0b;
            color: white;
        }
        
        .sidebar-controls {
            padding-top: 2rem;
            border-top: 1px solid rgba(245, 158, 11, 0.1);
            display: flex;
            gap: 0.75rem;
        }
        
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }

        /* MOBILE OPTIMIZADO - VERSI√ìN AGRESIVA */
        @media (max-width: 1023px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
                padding: 0 !important;
            }
            .mobile-header {
                display: flex !important;
            }
            
            /* === TAMA√ëOS DE FUENTE MUCHO M√ÅS GRANDES === */
            html {
                font-size: 18px !important;
            }
            
            body {
                font-size: 18px !important;
                line-height: 1.7 !important;
            }
            
            /* Main con padding generoso */
            main {
                padding: 2rem 1.5rem !important;
            }
            
            /* Tarjetas grandes y legibles */
            .warm-card {
                border-radius: 1.5rem !important;
                padding: 2rem !important;
            }
            
            #welcome-section .warm-card {
                padding: 2.5rem 2rem !important;
            }
            
            /* Carousel m√°s grande */
            .swiper {
                height: 65vh !important;
                border-radius: 1.5rem !important;
            }
            
            .swiper-slide > div {
                padding: 2.5rem 2rem !important;
            }
            
            /* T√≠tulos del carousel MUCHO m√°s grandes */
            .swiper-slide h3 {
                font-size: 2.5rem !important;
                line-height: 1.2 !important;
                margin-bottom: 2rem !important;
            }
            
            .swiper-slide p {
                font-size: 1.25rem !important;
                line-height: 1.6 !important;
            }
            
            .swiper-slide button {
                font-size: 1rem !important;
                padding: 1.25rem 2.5rem !important;
            }
            
            /* Grid de posts */
            #posts-grid {
                gap: 2rem !important;
            }
            
            /* T√≠tulos principales GRANDES */
            h2 {
                font-size: 2.25rem !important;
                line-height: 1.3 !important;
                margin-bottom: 2rem !important;
            }
            
            /* Art√≠culos */
            article h3 {
                font-size: 1.75rem !important;
                line-height: 1.3 !important;
                margin-bottom: 1rem !important;
            }
            
            article p {
                font-size: 1.125rem !important;
                line-height: 1.7 !important;
            }
            
            article > div.p-12 {
                padding: 2rem !important;
            }
            
            article > div.h-72 {
                height: 16rem !important;
            }
            
            article span {
                font-size: 1rem !important;
            }
            
            /* Botones grandes y t√°ctiles */
            button {
                min-height: 52px !important;
                font-size: 1.05rem !important;
                padding: 1rem 1.75rem !important;
            }
            
            /* Inputs grandes */
            textarea {
                font-size: 18px !important;
                padding: 1.25rem !important;
                line-height: 1.6 !important;
            }
            
            /* Vista de art√≠culo completo */
            .prose {
                font-size: 1.25rem !important;
                line-height: 1.75 !important;
            }
            
            .prose h1 {
                font-size: 2.75rem !important;
                line-height: 1.2 !important;
                margin-bottom: 2rem !important;
            }
            
            .prose h2 {
                font-size: 2.25rem !important;
                line-height: 1.3 !important;
            }
            
            .prose h3 {
                font-size: 1.875rem !important;
                line-height: 1.3 !important;
            }
            
            .prose p {
                font-size: 1.25rem !important;
                line-height: 1.75 !important;
                margin-bottom: 1.5rem !important;
            }
            
            .prose li {
                font-size: 1.25rem !important;
                line-height: 1.75 !important;
                margin-bottom: 0.75rem !important;
            }
            
            .prose img {
                margin: 2rem 0 !important;
                border-radius: 1.5rem !important;
            }
            
            /* Secci√≥n de comentarios */
            #post-view .warm-card {
                padding: 2rem !important;
            }
            
            #post-view .warm-card h3 {
                font-size: 2rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            #post-view .warm-card p {
                font-size: 1.125rem !important;
                line-height: 1.7 !important;
                margin-bottom: 1.5rem !important;
            }
            
            /* Comentarios individuales */
            #comments-list > div {
                font-size: 1.125rem !important;
                line-height: 1.7 !important;
                padding: 1.5rem !important;
            }
            
            /* Bot√≥n de regreso */
            #post-view > button {
                padding: 1rem 2rem !important;
                font-size: 0.9rem !important;
                margin-bottom: 2rem !important;
            }
            
            /* Footer */
            footer {
                padding: 3rem 0 !important;
            }
            
            footer p {
                font-size: 0.8rem !important;
            }
        }
        
        /* Para pantallas MUY peque√±as */
        @media (max-width: 374px) {
            html {
                font-size: 17px !important;
            }
            
            main {
                padding: 1.5rem 1rem !important;
            }
            
            .swiper-slide h3 {
                font-size: 2rem !important;
            }
            
            h2 {
                font-size: 1.875rem !important;
            }
        }
        
        .mobile-header {
            display: none;
            position: sticky;
            top: 0;
            z-index: 999;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(245, 158, 11, 0.1);
            padding: 1rem 1.5rem;
            justify-content: space-between;
            align-items: center;
        }
        .dark .mobile-header {
            background: rgba(8, 10, 15, 0.95);
        }

        /* PART√çCULAS DE LUZ */
        #particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .particle {
            position: absolute; bottom: -50px;
            background: radial-gradient(circle, rgba(251, 191, 36, 1) 0%, rgba(217, 119, 6, 0.4) 40%, rgba(217, 119, 6, 0) 80%);
            border-radius: 50%;
            box-shadow: 0 0 25px 5px rgba(251, 191, 36, 0.3);
            animation: floatUp var(--duration) linear infinite;
            filter: blur(var(--blur)); opacity: 0;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; }
            10% { opacity: var(--opacity); }
            80% { opacity: var(--opacity); }
            100% { transform: translateY(-120vh) translateX(var(--drift)) scale(1.3); opacity: 0; }
        }

        .swiper { width: 100%; height: 75vh; border-radius: 3.5rem; }
        .slide-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(8, 10, 15, 0.9) 0%, rgba(8, 10, 15, 0.3) 100%); }
        .prose { max-width: 850px !important; }
        .prose img { border-radius: 3rem; box-shadow: 0 30px 60px -12px rgba(0,0,0,0.3); }
        .hidden-view { display: none; }
        .warm-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(251, 191, 36, 0.1); }
        .dark .warm-card { background: rgba(15, 23, 42, 0.4); border-color: rgba(251, 191, 36, 0.05); }

        /* PWA Install Button Animation */
        @keyframes slideInUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-warmLight text-slate-800 dark:bg-warmDark dark:text-slate-100 transition-colors duration-1000">

    <div id="particle-container"></div>

    <!-- SIDEBAR DESKTOP -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-logo">
            <button onclick="showHome()" class="flex items-center gap-3 group">
                <img src="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png" alt="Logo" class="w-12 h-12 object-contain group-hover:rotate-12 transition">
                <div class="flex flex-col items-start">
                    <span class="text-lg font-black tracking-tighter text-amber-600 uppercase leading-tight">TU REFUGIO</span>
                    <span class="text-lg font-black tracking-tighter text-slate-900 dark:text-white italic leading-tight">DIGITAL</span>
                </div>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="crisis.html" class="sidebar-link text-red-600 hover:text-red-600">
                <span class="text-xl">üÜò</span>
                <span>Ayuda Ahora</span>
            </a>
            <a href="recomendaciones.html" class="sidebar-link text-slate-700 dark:text-slate-300">
                <span class="text-xl">‚ú®</span>
                <span>Recomendaciones</span>
            </a>
            <a href="chat/index.html" class="sidebar-link text-slate-700 dark:text-slate-300">
                <span class="text-xl">üí¨</span>
                <span>Chat Privado</span>
            </a>
            <a href="refugio.html" class="sidebar-link text-slate-700 dark:text-slate-300">
                <span class="text-xl">üõñ</span>
                <span>El Refugio</span>
            </a>
            <a href="reflexiones.html" class="sidebar-link text-slate-700 dark:text-slate-300">
                <span class="text-xl">üìñ</span>
                <span>Reflexiones</span>
            </a>
        </nav>
        
        <div class="sidebar-controls">
            <button onclick="toggleMusic()" id="music-btn-sidebar" class="flex-1 p-3 rounded-xl bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20 transition">
                <svg id="speaker-icon-sidebar" class="w-6 h-6 mx-auto" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
            </button>
            <button onclick="toggleDarkMode()" class="flex-1 p-3 rounded-xl bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20 transition">
                <svg class="w-6 h-6 mx-auto" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                </svg>
            </button>
        </div>
    </aside>

    <!-- HEADER MOBILE -->
    <div class="mobile-header">
        <button onclick="showHome()" class="flex items-center gap-2">
            <img src="https://jkhrpbpdewhkzgqqrwmp.supabase.co/storage/v1/object/public/imagenes/logo.png" alt="Logo" class="w-8 h-8 object-contain">
            <span class="text-lg font-black tracking-tighter text-amber-600 uppercase">TU REFUGIO</span>
        </button>
        
        <div class="flex items-center gap-2">
            <button onclick="toggleMusic()" id="music-btn-mobile" class="p-2 rounded-full bg-amber-500/10 text-amber-600">
                <svg id="speaker-icon-mobile" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
            </button>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full bg-amber-500/10 text-amber-600">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                </svg>
            </button>
            <button onclick="toggleSidebar()" class="p-2 rounded-full bg-amber-600 text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- PORTADA -->
        <main id="home-view" class="max-w-7xl mx-auto px-6 py-10 relative z-10">
            <section class="mb-24">
                <div class="swiper mySwiper shadow-2xl">
                    <div class="swiper-wrapper" id="carousel-wrapper"></div>
                    <div class="swiper-pagination"></div>
                </div>
            </section>

            <section id="welcome-section" class="mb-28 hidden">
                <div class="warm-card rounded-[5rem] p-12 md:p-24 shadow-2xl border border-amber-500/10">
                    <div id="welcome-content" class="prose prose-slate dark:prose-invert lg:prose-2xl mx-auto italic text-center font-light"></div>
                </div>
            </section>

            <section>
                <h2 class="text-4xl font-black mb-20 text-center tracking-tighter opacity-80 italic uppercase">Explorar el <span class="text-amber-600">Saber</span></h2>
                <div id="posts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-14"></div>
            </section>
        </main>

        <!-- LECTURA -->
        <main id="post-view" class="max-w-5xl mx-auto px-6 py-16 hidden-view relative z-10">
            <button onclick="showHome()" class="mb-12 flex items-center text-amber-700 dark:text-amber-300 font-bold bg-amber-500/10 px-8 py-4 rounded-full hover:bg-amber-600 hover:text-white transition-all shadow-xl uppercase text-xs tracking-widest">‚Üê Regresar al Inicio</button>
            <article id="full-article-content" class="prose prose-slate dark:prose-invert lg:prose-2xl mx-auto"></article>
        </main>

        <footer class="py-32 text-center opacity-40">
            <p class="text-xs font-bold uppercase tracking-[0.6em]">Tu Refugio Digital ‚Ä¢ 2025</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="music-player.js"></script> 
    
    <script>
        const _supabase = supabase.createClient('https://jkhrpbpdewhkzgqqrwmp.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpraHJwYnBkZXdoa3pncXFyd21wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwOTI2NDEsImV4cCI6MjA4MTY2ODY0MX0.BHLSQr9HNu8xwSX-Q3smsNvmosHJMKrfLbYRmfOyUhE');

        function toggleSidebar() { 
            document.getElementById('sidebar').classList.toggle('open'); 
        }

        // --- PARTICLE ENGINE ---
        const particleContainer = document.getElementById('particle-container');
        function createParticle() {
            const p = document.createElement('div');
            const size = Math.random() * 12 + 4;
            const duration = Math.random() * 18 + 12;
            p.className = 'particle';
            p.style.width = `${size}px`; p.style.height = `${size}px`;
            p.style.left = `${Math.random() * 100}%`;
            p.style.setProperty('--duration', `${duration}s`);
            p.style.setProperty('--drift', `${(Math.random() - 0.5) * 350}px`);
            p.style.setProperty('--opacity', Math.random() * 0.5 + 0.1);
            p.style.setProperty('--blur', '2px');
            particleContainer.appendChild(p);
            setTimeout(() => p.remove(), duration * 1000);
        }
        setInterval(createParticle, 280);

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        }
        if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');

        function showHome() {
            document.getElementById('home-view').classList.remove('hidden-view');
            document.getElementById('post-view').classList.add('hidden-view');
            document.getElementById('sidebar').classList.remove('open');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        async function loadComments(postId) {
            const container = document.getElementById('comments-list');
            const { data, error } = await _supabase.from('comments').select('*').eq('post_id', postId).order('created_at', { ascending: false });
            if (error || !container) return;
            container.innerHTML = data.length === 0 ? '<p class="text-center opacity-30 italic py-10">A√∫n no hay reflexiones. S√© el primero en compartir.</p>' : data.map(c => `<div class="mb-6 p-8 rounded-[3rem] bg-amber-500/5 border border-amber-500/10 italic text-slate-700 dark:text-slate-300">"${c.content}"</div>`).join('');
        }

        async function sendComment(btn, postId) {
            const area = document.getElementById('user-comment');
            if (area.value.trim().length < 3) return;
            btn.disabled = true; btn.innerHTML = "Guardando...";
            const { error } = await _supabase.from('comments').insert([{ post_id: postId, content: area.value.trim() }]);
            if (!error) { area.value = ""; loadComments(postId); btn.innerHTML = "Enviado"; setTimeout(() => { btn.disabled = false; btn.innerHTML = "Enviar Reflexi√≥n An√≥nima"; }, 2000); }
        }

        let allPosts = [];
        function openPost(index) {
            const post = allPosts[index];
            const content = document.getElementById('full-article-content');
            content.innerHTML = `<header class="mb-16 text-center"><h1 class="text-5xl md:text-7xl font-black mb-8 tracking-tighter leading-tight">${post.title.$t}</h1><div class="h-1.5 w-32 bg-amber-500 mx-auto rounded-full"></div></header><div class="article-body">${post.content.$t}</div>
                <div class="mt-20 pt-16 border-t border-amber-500/20">
                    <div class="warm-card p-8 md:p-12 rounded-[4rem] shadow-2xl border border-amber-500/10">
                        <h3 class="text-3xl font-black mb-4 tracking-tighter italic text-amber-600">Espacio de <span class="text-amber-600">Reflexi√≥n</span></h3>
                        <p class="text-base text-slate-500 dark:text-slate-400 mb-8 leading-relaxed">Este es un lugar seguro. Te invitamos a compartir una experiencia, una duda o simplemente lo que esta lectura ha despertado en ti. <span class="block mt-2 font-bold text-amber-600/80 uppercase text-[10px] tracking-[0.2em]">üõ°Ô∏è Tu comentario ser√° publicado de forma totalmente an√≥nima.</span></p>
                        <textarea id="user-comment" rows="5" class="w-full bg-white/50 dark:bg-black/20 border-2 border-amber-500/10 rounded-3xl p-6 focus:border-amber-500 outline-none transition-all text-lg resize-none placeholder:italic" placeholder="Escribe aqu√≠ tu pensamiento..."></textarea>
                        <div class="flex flex-col md:flex-row items-center justify-between gap-6 mt-6"><p class="text-xs text-slate-400 italic">"Las palabras son puentes entre almas."</p><button onclick="sendComment(this, '${post.id.$t}')" class="w-full md:w-auto px-10 py-4 bg-amber-600 text-white font-bold rounded-full hover:bg-amber-500 transition-all shadow-lg uppercase text-xs tracking-widest">Enviar Reflexi√≥n An√≥nima</button></div>
                    </div>
                </div><div id="comments-list" class="mt-12 space-y-6"></div>`;
            document.getElementById('home-view').classList.add('hidden-view');
            document.getElementById('post-view').classList.remove('hidden-view');
            window.scrollTo({top: 0, behavior: 'instant'});
            loadComments(post.id.$t);
        }

        function renderBlog(json) {
            allPosts = json.feed.entry;
            const carousel = document.getElementById('carousel-wrapper');
            const grid = document.getElementById('posts-grid');
            const welcome = document.getElementById('welcome-section');
            allPosts.forEach((entry, index) => {
                const title = entry.title.$t;
                const tempDiv = document.createElement('div'); tempDiv.innerHTML = entry.content.$t;
                const img = tempDiv.querySelector('img') ? tempDiv.querySelector('img').src.replace('/s72-c/', '/s1600/') : 'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1600';
                const snippet = tempDiv.textContent.trim().substring(0, 160) + "...";
                if (title.includes("La Conexi√≥n, tu refugio")) { welcome.classList.remove('hidden'); document.getElementById('welcome-content').innerHTML = entry.content.$t; }
                carousel.innerHTML += `<div class="swiper-slide cursor-pointer" onclick="openPost(${index})"><img src="${img}" class="absolute inset-0 w-full h-full object-cover"><div class="slide-overlay"></div><div class="relative z-10 p-12 h-full flex flex-col justify-center items-center text-center text-white"><h3 class="text-4xl md:text-7xl font-black mb-10 leading-none">${title}</h3><p class="mb-12 max-w-2xl text-xl font-light">${snippet}</p><button class="bg-amber-600 px-14 py-6 rounded-full font-bold uppercase tracking-widest text-xs">Entrar al Saber</button></div></div>`;
                grid.innerHTML += `<article class="warm-card rounded-[4rem] overflow-hidden group cursor-pointer shadow-xl transition-all duration-700" onclick="openPost(${index})"><div class="h-72 overflow-hidden relative"><img src="${img}" class="w-full h-full object-cover group-hover:scale-110 transition duration-1000"></div><div class="p-12"><h3 class="font-black text-2xl mb-6 group-hover:text-amber-600 transition-colors duration-500">${title}</h3><p class="text-slate-500 dark:text-slate-400 text-sm mb-10 line-clamp-3">${snippet}</p><span class="text-amber-600 font-bold text-xs uppercase tracking-widest">Explorar ‚Üí</span></div></article>`;
            });
            new Swiper(".mySwiper", { loop: true, speed: 1200, autoplay: { delay: 7000 }, pagination: { el: ".swiper-pagination", clickable: true }, effect: "fade" });
        }
    </script>

    <!-- PWA: SERVICE WORKER REGISTRATION -->
    <script>
        // Verificar si el navegador soporta Service Workers
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado correctamente:', registration.scope);
                        
                        // Verificar actualizaciones cada hora
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000);
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
            });
        }

        // ============================================
        // PROMPT DE INSTALACI√ìN DE LA APP
        // ============================================

        let deferredPrompt;
        let installButton;

        // Crear el bot√≥n de instalaci√≥n
        function createInstallButton() {
            if (document.getElementById('pwa-install-btn')) return;
            
            const btn = document.createElement('button');
            btn.id = 'pwa-install-btn';
            btn.innerHTML = `
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Instalar App
            `;
            btn.className = 'fixed bottom-6 right-6 z-50 flex items-center px-6 py-4 bg-amber-600 text-white font-bold rounded-full shadow-2xl hover:bg-amber-500 transition-all transform hover:scale-105 text-sm uppercase tracking-wider';
            btn.style.animation = 'slideInUp 0.5s ease-out';
            
            btn.onclick = async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('‚úÖ Usuario acept√≥ instalar la app');
                } else {
                    console.log('‚ùå Usuario rechaz√≥ instalar la app');
                }
                
                deferredPrompt = null;
                btn.remove();
            };
            
            document.body.appendChild(btn);
            installButton = btn;
        }

        // Escuchar el evento beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevenir el mini-infobar en Chrome
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar bot√≥n de instalaci√≥n despu√©s de 3 segundos
            setTimeout(() => {
                createInstallButton();
            }, 3000);
        });

        // Detectar cuando la app fue instalada
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA instalada correctamente');
            if (installButton) {
                installButton.remove();
            }
            deferredPrompt = null;
        });
    </script>
    
    <script src="https://turefugiodigital.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=500&callback=renderBlog"></script>
</body>
</html>